<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Real Data Analysis</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .result { background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .highlight { background: #fff3cd; padding: 2px 4px; border-radius: 3px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <h1>üß™ Test Real Data Analysis</h1>
    <p>This page tests our improved analysis system with realistic data structures to ensure it provides accurate, specific fit information.</p>

    <div class="test-section">
        <h2>1. Simulated API Response for Allsaints</h2>
        <p>Testing with realistic data that might come from the search-reviews API:</p>
        
        <div class="result">
            <h3>Sample API Data:</h3>
            <pre id="api-data"></pre>
            
            <button onclick="testRealDataAnalysis()">Analyze Real Data</button>
            <div id="analysis-result"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>2. Expected vs Actual Results</h2>
        <p>Comparing what we should get vs what the old system was giving:</p>
        
        <div class="result">
            <div class="warning">
                <h4>‚ùå Old System (Generic):</h4>
                <p>"Runs small ‚Äî consider sizing up"</p>
            </div>
            
            <div class="success">
                <h4>‚úÖ New System (Specific):</h4>
                <p id="expected-result">Loading...</p>
            </div>
        </div>
    </div>

    <script>
        // Simulate the API response structure
        const mockApiResponse = {
            totalResults: 12,
            reviews: [
                {
                    title: "Allsaints Leather Jacket Review",
                    snippet: "This Allsaints leather jacket runs small, I had to size up from my usual M to L. The fit is perfect now and the quality is amazing.",
                    confidence: "high",
                    tags: ["leather", "jacket", "quality"]
                },
                {
                    title: "Allsaints Dresses Sizing",
                    snippet: "Allsaints dresses tend to run small, especially in the bust area. I'm usually a size 6 but need an 8 in their dresses.",
                    confidence: "high",
                    tags: ["dress", "sizing", "bust"]
                },
                {
                    title: "Allsaints Tops Fit",
                    snippet: "Their tops are more true to size, but the dresses definitely run small. I sized up in dresses but stayed my usual size in tops.",
                    confidence: "medium",
                    tags: ["tops", "dresses", "sizing"]
                },
                {
                    title: "Allsaints Jeans Review",
                    snippet: "The jeans fit snug but that's the intended style. They're not running small, just designed to be fitted.",
                    confidence: "high",
                    tags: ["jeans", "fit", "style"]
                },
                {
                    title: "Allsaints Outerwear Sizing",
                    snippet: "I found their outerwear to be true to size. The coats and jackets fit as expected for my usual size.",
                    confidence: "medium",
                    tags: ["outerwear", "coats", "jackets"]
                },
                {
                    title: "Allsaints Blouse Sizing",
                    snippet: "The blouses run small in the shoulders. I had to size up from my usual size to get a comfortable fit.",
                    confidence: "high",
                    tags: ["blouse", "shoulders", "sizing"]
                }
            ],
            brandFitSummary: {
                summary: "Runs small ‚Äî consider sizing up", // This is the generic API summary we want to override
                confidence: "medium",
                sources: ["various sources"]
            }
        };

        // Display the API data
        document.getElementById('api-data').textContent = JSON.stringify(mockApiResponse, null, 2);

        // Simulate our improved analysis functions
        function analyzeFitMentions(reviews) {
            const analysis = {
                runsSmall: 0,
                runsLarge: 0,
                trueToSize: 0,
                inconsistent: 0,
                categorySpecific: 0,
                total: 0
            };

            if (!reviews || !Array.isArray(reviews)) {
                return analysis;
            }

            reviews.forEach(review => {
                if (!review.snippet && !review.content) return;

                const text = (review.snippet || review.content || '').toLowerCase();
                
                // Count different types of fit mentions - be more aggressive in detection
                if (text.includes('runs small') || text.includes('size up') || text.includes('fits small') || 
                    text.includes('too small') || text.includes('tight fit') || text.includes('smaller than expected') ||
                    text.includes('had to size up') || text.includes('needed to size up') || text.includes('sized up') ||
                    text.includes('fits snug') || text.includes('snug fit') || text.includes('tight') ||
                    text.includes('smaller') || text.includes('too tight') || text.includes('fits tight')) {
                    analysis.runsSmall++;
                    analysis.total++;
                }
                
                if (text.includes('runs large') || text.includes('size down') || text.includes('fits large') ||
                    text.includes('too big') || text.includes('loose fit') || text.includes('oversized') ||
                    text.includes('larger than expected') || text.includes('had to size down') || 
                    text.includes('needed to size down') || text.includes('sized down') ||
                    text.includes('fits loose') || text.includes('loose') || text.includes('too loose') ||
                    text.includes('baggy') || text.includes('oversized fit')) {
                    analysis.runsLarge++;
                    analysis.total++;
                }
                
                if (text.includes('true to size') || text.includes('fits true') || text.includes('tts') ||
                    text.includes('standard sizing') || text.includes('normal fit') || text.includes('fits as expected') ||
                    text.includes('fits perfectly') || text.includes('exact fit') || text.includes('usual size') ||
                    text.includes('normal size') || text.includes('fits like a glove') || text.includes('perfect fit') ||
                    text.includes('fits just right') || text.includes('standard fit') || text.includes('fit as expected')) {
                    analysis.trueToSize++;
                    analysis.total++;
                }
                
                if (text.includes('inconsistent') || text.includes('varies') || text.includes('depends on') ||
                    text.includes('sometimes') || text.includes('hit or miss') || text.includes('unpredictable') ||
                    text.includes('mixed') || text.includes('depends') || text.includes('varies by') ||
                    text.includes('unreliable') || text.includes('inconsistent sizing')) {
                    analysis.inconsistent++;
                    analysis.total++;
                }
                
                if (text.includes('dresses') || text.includes('tops') || text.includes('bottoms') ||
                    text.includes('jeans') || text.includes('shirts') || text.includes('pants') ||
                    text.includes('skirts') || text.includes('outerwear') || text.includes('blouses') ||
                    text.includes('sweaters') || text.includes('jackets') || text.includes('coats')) {
                    analysis.categorySpecific++;
                    analysis.total++;
                }
            });

            return analysis;
        }

        function generateSpecificRecommendation(brandName, fitMentions) {
            const { runsSmall, runsLarge, trueToSize, inconsistent, categorySpecific, total } = fitMentions;
            
            // Find the most common pattern
            const patterns = [
                { type: 'runs small', count: runsSmall },
                { type: 'runs large', count: runsLarge },
                { type: 'true to size', count: trueToSize },
                { type: 'inconsistent', count: inconsistent },
                { type: 'category specific', count: categorySpecific }
            ].filter(p => p.count > 0).sort((a, b) => b.count - a.count);

            if (patterns.length === 0) {
                return `Found fit information for ${brandName}, but no clear sizing pattern emerged. Check individual reviews for specific advice.`;
            }

            const topPattern = patterns[0];
            const percentage = Math.round((topPattern.count / total) * 100);
            
            let recommendation = '';
            
            switch (topPattern.type) {
                case 'runs small':
                    if (percentage >= 70) {
                        recommendation = `Based on ${total} reviews, ${brandName} consistently runs small (${percentage}% of mentions). Consider sizing up for a comfortable fit.`;
                    } else if (percentage >= 50) {
                        recommendation = `Based on ${total} reviews, ${brandName} tends to run small (${percentage}% of mentions). Most reviewers recommend sizing up.`;
                    } else {
                        recommendation = `Based on ${total} reviews, ${brandName} has mixed sizing with ${percentage}% reporting it runs small. Check individual reviews for specific advice.`;
                    }
                    break;
                    
                case 'runs large':
                    if (percentage >= 70) {
                        recommendation = `Based on ${total} reviews, ${brandName} consistently runs large (${percentage}% of mentions). Consider sizing down for a better fit.`;
                    } else if (percentage >= 50) {
                        recommendation = `Based on ${brandName} tends to run large (${percentage}% of mentions). Most reviewers recommend sizing down.`;
                    } else {
                        recommendation = `Based on ${total} reviews, ${brandName} has mixed sizing with ${percentage}% reporting it runs large. Check individual reviews for specific advice.`;
                    }
                    break;
                    
                case 'true to size':
                    if (percentage >= 70) {
                        recommendation = `Based on ${total} reviews, ${brandName} consistently runs true to size (${percentage}% of mentions). You can typically order your usual size.`;
                    } else if (percentage >= 50) {
                        recommendation = `Based on ${total} reviews, ${brandName} generally runs true to size (${percentage}% of mentions). Most reviewers found the sizing accurate.`;
                    } else {
                        recommendation = `Based on ${total} reviews, ${brandName} has mixed sizing with ${percentage}% reporting it runs true to size. Check individual reviews for specific advice.`;
                    }
                    break;
                    
                case 'inconsistent':
                    recommendation = `Based on ${total} reviews, sizing for ${brandName} can be inconsistent (${percentage}% of mentions). It's recommended to check specific item reviews or size charts.`;
                    break;
                    
                case 'category specific':
                    recommendation = `Based on ${total} reviews, sizing for ${brandName} varies by category (${percentage}% of mentions). Check individual item reviews for specific fit advice.`;
                    break;
                    
                default:
                    recommendation = `Found ${total} reviews with fit information for ${brandName}. Check individual reviews for specific sizing advice.`;
            }

            // Add context about other patterns if they exist
            const otherPatterns = patterns.slice(1).filter(p => p.count > 0);
            if (otherPatterns.length > 0) {
                const otherMentions = otherPatterns.map(p => `${p.count} ${p.type.replace(' ', ' ')}`).join(', ');
                recommendation += ` Other patterns found: ${otherMentions}.`;
            }

            return recommendation;
        }

        function testRealDataAnalysis() {
            const { reviews, brandFitSummary } = mockApiResponse;
            
            // Analyze the fit mentions
            const fitMentions = analyzeFitMentions(reviews);
            
            // Generate specific recommendation
            const recommendation = generateSpecificRecommendation("Allsaints", fitMentions);
            
            // Display results
            document.getElementById('analysis-result').innerHTML = `
                <h4>Analysis Results:</h4>
                <ul>
                    <li><span class="highlight">Runs Small:</span> ${fitMentions.runsSmall}</li>
                    <li><span class="highlight">Runs Large:</span> ${fitMentions.runsLarge}</li>
                    <li><span class="highlight">True to Size:</span> ${fitMentions.trueToSize}</li>
                    <li><span class="highlight">Inconsistent:</span> ${fitMentions.inconsistent}</li>
                    <li><span class="highlight">Category Specific:</span> ${fitMentions.categorySpecific}</li>
                    <li><span class="highlight">Total Fit Mentions:</span> ${fitMentions.total}</li>
                </ul>
                
                <h4>Generated Recommendation:</h4>
                <div class="success" style="padding: 10px; margin: 10px 0;">
                    ${recommendation}
                </div>
                
                <h4>API Summary (Generic):</h4>
                <div class="warning" style="padding: 10px; margin: 10px 0;">
                    ${brandFitSummary.summary}
                </div>
            `;
            
            // Update expected result
            document.getElementById('expected-result').textContent = recommendation;
        }

        // Run the test automatically
        window.onload = function() {
            setTimeout(testRealDataAnalysis, 1000);
        };
    </script>
</body>
</html>
